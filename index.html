<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>RiskyTikTokDownloader</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
  <style>
    .swiper-button-next, .swiper-button-prev {
      color: #a78bfa;
    }
    .swiper-pagination-bullet-active {
      background-color: #8b5cf6;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4 font-sans">
  <div class="bg-gray-800 p-6 md:p-8 rounded-2xl shadow-2xl w-full max-w-lg">
    <div class="flex items-center justify-center space-x-3 mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="text-purple-400" viewBox="0 0 16 16">
            <path d="M9 0h1.98c.144.715.54 1.617 1.235 2.512C12.895 3.389 13.797 4 15 4v2c-1.753 0-3.07-.814-4-1.829V11a5 5 0 1 1-5-5v2a3 3 0 1 0 3 3V0Z"/>
        </svg>
        <h1 class="text-2xl md:text-3xl font-bold text-center text-purple-400">RiskyTikTokDownloader</h1>
    </div>

    <form id="downloadForm" class="space-y-4">
      <input type="text" id="tiktokUrl" placeholder="Tempel link TikTok di sini..." class="w-full px-4 py-3 rounded-lg bg-gray-700 text-white border-2 border-transparent focus:border-purple-500 focus:outline-none transition-colors">
      <button type="submit" id="downloadButton" class="w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-500 disabled:cursor-not-allowed py-3 rounded-lg font-semibold transition-transform transform hover:scale-105">Download</button>
    </form>

    <div id="result" class="mt-6 text-center space-y-4"></div>
  </div>

  <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
  <script>
    const form = document.getElementById('downloadForm');
    const resultContainer = document.getElementById('result');
    const urlInput = document.getElementById('tiktokUrl');
    const downloadButton = document.getElementById('downloadButton');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const inputUrl = urlInput.value.trim();
      
      resultContainer.innerHTML = '';
      downloadButton.disabled = true;
      downloadButton.innerText = 'Memproses...';

      if (!inputUrl || !inputUrl.includes('tiktok.com')) {
        Swal.fire('Error', 'Harap masukkan link TikTok yang valid!', 'error');
        downloadButton.disabled = false;
        downloadButton.innerText = 'Download';
        return;
      }

      Swal.fire({
        title: 'Mengambil data...',
        text: 'Mohon tunggu sebentar',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      try {
        const apiRes = await fetch(`https://tikwm.com/api/?url=${encodeURIComponent(inputUrl)}`);
        const data = await apiRes.json();

        Swal.close();

        if (data.code !== 0 || !data.data) {
          throw new Error(data.msg || 'Gagal mengambil data dari TikTok. Video mungkin privat atau link salah.');
        }

        const contentData = data.data;
        displayContent(contentData);

      } catch (err) {
        console.error(err);
        Swal.fire('Gagal', err.message || 'Terjadi kesalahan saat memproses permintaan Anda.', 'error');
      } finally {
        downloadButton.disabled = false;
        downloadButton.innerText = 'Download';
      }
    });

    function displayContent(data) {
      resultContainer.innerHTML = '';

      if (data.title) {
        const titleElement = document.createElement('p');
        titleElement.className = 'text-gray-300 italic px-2';
        titleElement.textContent = data.title;
        resultContainer.appendChild(titleElement);
      }

      if (data.images && data.images.length > 0) {
        displayImageSlider(data.images, data.music);
      } else if (data.play) {
        displayVideo(data.play, data.music);
      } else {
         resultContainer.innerHTML = '<p class="text-red-400">Konten tidak didukung atau tidak ditemukan.</p>';
      }
    }

    function displayVideo(videoUrl, musicUrl) {
      const video = document.createElement('video');
      video.controls = true;
      video.src = videoUrl;
      video.className = 'mx-auto rounded-lg w-full max-h-[60vh]';
      resultContainer.appendChild(video);
      
      const downloadButtonsContainer = document.createElement('div');
      downloadButtonsContainer.className = 'flex flex-col md:flex-row gap-3 justify-center mt-4';

      const videoBtn = createDownloadButton(videoUrl, 'tiktok_video.mp4', '‚¨áÔ∏è Download Video (Tanpa WM)');
      videoBtn.className = 'w-full md:w-auto inline-block bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition';
      downloadButtonsContainer.appendChild(videoBtn);
      
      if (musicUrl) {
        const audioBtn = createDownloadButton(musicUrl, 'tiktok_audio.mp3', 'üéµ Download Audio Saja');
        audioBtn.className = 'w-full md:w-auto inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition';
        downloadButtonsContainer.appendChild(audioBtn);
      }

      resultContainer.appendChild(downloadButtonsContainer);
    }

    function displayImageSlider(images, musicUrl) {
        const swiperContainer = document.createElement('div');
        swiperContainer.className = 'swiper-container rounded-lg mx-auto w-full';
        swiperContainer.innerHTML = `
            <div class="swiper-wrapper">
                ${images.map(img => `<div class="swiper-slide flex justify-center items-center bg-black"><img src="${img}" class="max-h-[60vh] object-contain"></div>`).join('')}
            </div>
            <div class="swiper-pagination"></div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
        `;
        resultContainer.appendChild(swiperContainer);

        new Swiper('.swiper-container', {
            loop: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
        
        const downloadButtonsContainer = document.createElement('div');
        downloadButtonsContainer.className = 'flex flex-col md:flex-row gap-3 justify-center mt-4 flex-wrap';

        images.forEach((imgUrl, index) => {
            const imgBtn = createDownloadButton(imgUrl, `tiktok_image_${index + 1}.jpeg`, `üñºÔ∏è Download Gambar ${index + 1}`);
            imgBtn.className = 'w-full sm:w-auto inline-block bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-lg font-semibold transition text-sm';
            downloadButtonsContainer.appendChild(imgBtn);
        });

        resultContainer.appendChild(downloadButtonsContainer);

        if (musicUrl) {
            const audioPlayer = document.createElement('audio');
            audioPlayer.controls = true;
            audioPlayer.src = musicUrl;
            audioPlayer.className = 'w-full mt-4';
            resultContainer.appendChild(audioPlayer);

            const audioBtn = createDownloadButton(musicUrl, 'tiktok_audio.mp3', 'üéµ Download Audio Slideshow');
            audioBtn.className = 'w-full inline-block bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 mt-2 rounded-lg font-semibold transition';
            resultContainer.appendChild(audioBtn);
        }
    }

    function createDownloadButton(url, filename, text) {
      const btn = document.createElement('a');
      btn.href = url;
      btn.download = filename;
      btn.target = '_blank';
      btn.rel = 'noopener noreferrer';
      btn.innerText = text;
      return btn;
    }
  </script>
</body>
</html>
